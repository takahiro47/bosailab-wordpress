extends _application
include _ui

block page_article
  .layer-header
    header.container-fluid
      .navi-title
        :php
          if ( is_day() ) :
            printf( __( 'Daily Archives: %s', 'twentyfourteen' ), get_the_date() );
          elseif ( is_month() ) :
            printf( __( 'Monthly Archives: %s', 'twentyfourteen' ), get_the_date( _x( 'F Y', 'monthly archives date format', 'twentyfourteen' ) ) );
          elseif ( is_year() ) :
            printf( __( 'Yearly Archives: %s', 'twentyfourteen' ), get_the_date( _x( 'Y', 'yearly archives date format', 'twentyfourteen' ) ) );
          else :
            echo 'すべて';
          endif;

      .controls
        ul.control-buttons(role='menu')
          li.filter(
            class!='<?php if ( !is_tax() && !is_single() ) { echo " active"; } ?>'
            data-filter!='.filter'
            data-title!='すべて'
          )
            a(href!='/<?php echo get_post_type(); ?>')
              | すべて
              //- <?php echo 'All '.ucfirst( get_post_type() ).'s'; ?>
          :php
            $args = array(
              'style'               => 'list',
              'orderby'             => 'name',
              'order'               => 'ASC',
              'taxonomy'            => substr(get_post_type(), 0, 2).'-types',
              'title_li'            => '',
              'show_count'          => 0, // 1
              'hide_empty'          => 0,
              'echo'                => 0
            );
            $html = wp_list_categories( $args );
            $html = preg_replace('/<\/a> \(([0-9]*)\)/', ' <em>$1</em></a>', $html);
            // JSフィルタのために最適化
            $html = preg_replace('/(cat-item)/', 'filter', $html);
            $html = preg_replace('/(current-cat)/', 'active', $html);
            $html = preg_replace('/><a\ href="(.*)"(.*)?>(.*)<\/a>/', ' data-filter=".filter-$3" data-title="$3"><a\ href="$1">$3</a>', $html);
            // 出力
            echo $html;

  :php
    if ( have_posts() ) {
  .container-fluid.archives
    .row
      //- 記事ループ
      :php
        while ( have_posts() ) {
          the_post();
          get_template_part( 'content', get_post_format() );
        }
  :php
    } else {
  .archives.nil
  :php
    get_template_part( 'content', 'none' );
    }


.page-layer__media--download--archive
  .page-layer__media--download__cell
    .archive-media--download-wrap
      .archive-media--download
        .archive-media--photograph-wrap
          .archive-media--header
            i.fa.fa-circle
            i.fa.fa-circle
            i.fa.fa-circle
          .archive-media--background
          a.js-navi-single(href!="confirm?edd_action=add_to_cart&download_id=<?php echo get_the_ID(); ?>")
            .archive-media--photograph(style!="background-image:url('<?php echo $thumbnail_url; ?>');")
            +ui-loader
            //- オーバーフロー
            .archive-media--overflow
              //- ダウンロードボタン
              .archive-media--download-button
                i.fa.fa-plus
                | Download Item
              //- ダウンロード回数
              //- .archive-media--download__views
              //-   i.fa.fa-download
              //-   | <?php echo $post->pvc_views; ?>
              //- アップロード日時
              .archive-media--download__date
                i.fa.fa-cloud-upload
                | <?php echo toLastUpdateString( new DateTime( get_the_time('Y-m-d H:i:s') ) ), PHP_EOL; ?>
            //- 抜粋
            p.archive-media--excerpt
              <?php echo new_excerpt(1000); ?>

        article.archive-media--download__article
          //- | <?php do_shortcode('[purchase_link id="'.get_the_ID().'" price=0 text="ダウンロード" style="button" direct="true"]'); ?>
          //- | <?php echo do_shortcode('[downloads]'); ?>
          h3.archive-media--download-title.ellipsis
            a.js-navi-single(href!="confirm?edd_action=add_to_cart&download_id=<?php echo get_the_ID(); ?>") <?php the_title(); ?>
          ul.archive-media--download-tags.ui-tags
            <?php $post_tags = get_the_tags(); if ($post_tags) { foreach($post_tags as $tag) { ?>
            li.tag <?php echo $tag->name; ?>
            <?php } } ?>